@using Tesco.ClubcardProducts.MCA.Web.Common.Entities.DBConfiguration
@using Tesco.ClubcardProducts.MCA.Web.Common
@using Tesco.ClubcardProducts.MCA.Web.Common.Entities.Common
@using Tesco.ClubcardProducts.MCA.Web.Common.Models
@using Tesco.ClubcardProducts.MCA.Web.Common.Entities.Settings
@using Tesco.ClubcardProducts.MCA.Web.Common.Utilities
@using System.Globalization

@model ManageCardsViewModel

@{
    ViewBag.Title = @Html.Translate("AccountManagement/ClubcardsOnAccount", "PageResource1.Title");
    ViewBag.dtmTitle = @Html.Translate("AccountManagement/ClubcardsOnAccount", "dtmPageTitle");
    ViewBag.PageName = "ClubcardsOnAccount";
    string dateFormat = DBConfigurationManager.Instance[DbConfigurationTypeEnum.AppSettings][AppConfigEnum.DisplayDateFormat.ToString()].ConfigurationValue1;
    
}
@section leftNavigation
{
    @Html.Partial("_LeftNavigation", Model)
}


<div class="row"><div class="gr-12">

<div class="copy-wrapper">
    <h1 id="lblheader" class="ddl-h2-like">@Html.Translate("lclVwCradsResource1") </h1>
    <p class="small">
        @Html.Translate("CardsVariousResource1")
    </p>
     <h2 class="ddl-h3-like">@Html.Translate("ltrNamesResource1")</h2>
</div>
     
                <div class="table-wrapper table-bordered">
                    <table>
                    <thead>
                    <tr>
                  <th id='thMCardnumbername'></th>
                  <th id='thACardnumbername'>@Html.Translate("thcardholdername")</th>
                    </tr>
                    </thead>
                        <tbody>
                         <tr>
                         <td id="tdMainCardhlder" style="font-family:tescobold">@Html.Translate("tdMainCardholder")</td>
                         <td id="tdMainhldrName">@Model.Households[0].FullName </td>
                         </tr>
                           <tr>
                           @if (Model.Households.Count > 1)
                           {
                           <td id="tdAssCardhlder" style="font-family:tescobold">@Html.Translate("tdAsscardholder")</td>
                         <td id="tdAsshldrName">
                         @Model.Households[1].FullName
                         </td>
                           }
                         </tr>
                        </tbody>
                    </table></div>
                    
    @for (int i = 0; i < Model.Households.Count; i++)
    {
        if (!Model.Households[i].IsCustomerBanned)
        {
             <div class="copy-wrapper"><h2 class="ddl-h3-like">@Html.Translate((Model.Households[i].CustomerType == "M") ? "CustomerTypeMain" : "CustomerTypeAssoc")</h2></div>
            <div class="table-wrapper">
                    <table border="0" cellpadding="0" cellspacing="0" class="filtered" data-filterSelect1="Venue" data-filterSelect2="Format">
                        <thead>
                            <tr>
                                <th id='thCardnumber'>@Html.Translate("CardnumberResource1")</th>
                                @if (!DBConfigurationManager.Instance[DbConfigurationTypeEnum.AppSettings][AppConfigEnum.ShowTypeofCard.ToString()].ConfigurationValue1.ToUpper().Equals("FALSE"))
                                {
                                    <th id='thTypeofCard'>@Html.Translate("Typeofcard")</th>
                                }
                                <th id='thLasttimeused' class="text-centre">@Html.Translate("LasttimeusedResource1")</th>
                                <th id='thWhere'>@Html.Translate("WhereResource1")</th>
                            </tr> 
                        </thead>
                        <tfoot>
                            <tr>
                            </tr>
                        </tfoot>
                        <tbody>
                            @for (int j = 0; j < Model.Households[i].Cards.Count; j++)
                            { 
                                <tr>
                                    @if (string.IsNullOrWhiteSpace(Model.Households[i].Cards[j].ClubCardID.ToString()))
                                    {
                                        <td></td> 
                                    }
                                    else
                                    { 
                                        <td id='@("ClubCardID" + i)'>@GeneralUtility.MasknFormatClubcard(Model.Households[i].Cards[j].ClubCardID.ToString(), true, 'X')</td>
                                    }
                                    @if (!DBConfigurationManager.Instance[DbConfigurationTypeEnum.AppSettings][AppConfigEnum.ShowTypeofCard.ToString()].ConfigurationValue1.ToUpper().Equals("FALSE"))
                                    {
                                        if (string.IsNullOrWhiteSpace(Model.Households[i].Cards[j].ClubCardTypeDesc))
                                        {
                                            <td></td> 
                                        }
                                        else
                                        { 
                                            <td id='@("ClubcardType" + i)'>@Model.Households[i].Cards[j].ClubCardTypeDesc</td>
                                        }
                                    }
                                   
                                        <td  class="text-centre" id='@("ClubCardTypeDesc" + i)' data-mobileheader='@Html.Translate("LasttimeusedResource1")'>
                                         @switch (Model.Households[i].Cards[j].LastUsed)
                                         {
                                             case ManageCardsViewModel.LastusedState.OlderThanThreshold :
                                                 @Html.Translate("lclMore")
                                                 break;
                                             case ManageCardsViewModel.LastusedState.NewJoinee :
                                                  case ManageCardsViewModel.LastusedState.TransactionTypeMatch :
                                                 @Html.Translate("Hyphen")
                                                 break;
                                                  case ManageCardsViewModel.LastusedState.ActualDate:
                                                 @Model.Households[i].Cards[j].TransactionDateTime.Value.ToString(dateFormat, CultureInfo.InvariantCulture);
                                                  break;
                                                  default:
                                                  break;
                                         }
                                        
                                        </td>
                                    
                                    @if (string.IsNullOrWhiteSpace(Model.Households[i].Cards[j].StoreName))
                                    {
                                        <td></td> 
                                    }
                                    else
                                    {    
                                        <td id='@("StoreName" + i)'>@Model.Households[i].Cards[j].StoreName</td>
                                    }
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
             
        }
    }
    <div class="copy-wrapper">
        @if (Model.HouseholdCount > 1)
        {
           <p> @Html.Translate("lclAnothercardlistedResource1")
            <strong>@Html.Translate("lcltollfree1Resource1")
            @Html.Translate("lcltollfree1starResource1")
            <span id="lbltollfree1" class="no-wrap">@Html.Translate("lcltollfree2Resource2")
            @Html.Translate("lcltollfree2starResource2")</span></strong>
            @Html.Translate("lclAnothercardlistedResource3")</p>
        }
        else
        {
            <p>@Html.Translate("lclAnothercardlistedResource1")
            <strong>@Html.Translate("lcltollfree1Resource1")
            @Html.Translate("lcltollfree1starResource1")
            <span id="lbltollfree2" class="no-wrap">@Html.Translate("lcltollfree2Resource2")
            @Html.Translate("lcltollfree2starResource2")</span></strong>
            @Html.Translate("lclAnothercardlistedResource2")</p>
          
        } 
       


   
    <p class="small">
          @Html.Translate("Localize6Resource1")<strong>@Html.Translate("Localize1Resource1")</strong>
         <a href='@Resources.ConfigLinks.MCHFaq' target='@GeneralUtility.IsExternalLink(Resources.ConfigLinks.MCHFaq) ? "_blank" : "_self"'> @Html.Translate("FAQSResource1")</a> 
          @Html.Translate("furtheirdtlsResource1")</p>
    <p class="ddl-t5"><sup>1</sup>@Html.Translate("CommunicateMsg1Resource1")</p>
    <p class="ddl-t5"><sup>2</sup>@Html.Translate("CommunicateMsg2Resource1")</p>
     </div>
</div></div>
