<?xml version="1.0" encoding="UTF-8"?>
<!-- Include the references to the Project and the GUIDS inclusion-->
<?include Project.wxi ?>
<?include Guids.wxi ?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
	<Product Id="$(var.ProductGuid)" Name="$(var.ProductName) ($(var.Version))" Language="1033" Version="$(var.Version)" Manufacturer="Tesco.Com" UpgradeCode="$(var.UpgradeCode)">
		<Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine" />

		<!-- Custom Actions -->
		<InstallExecuteSequence>
			<!-- The TARGETDIR is "" if it is not specified -->
			<Custom Action="DefaultInstallDrive" Before="CostInitialize" ><![CDATA[INSTALLDRIVE=""]]></Custom>
			<Custom Action='WixExitEarlyWithSuccess' After='FindRelatedProducts'>Installed AND NOT UPGRADEFOUND AND NOT Preselected</Custom>
			<RemoveExistingProducts After='InstallInitialize' />
		</InstallExecuteSequence>

		<!-- Initialise the Install Drive, Base Directory and the Log Drive if not specified in the call to the MSI-->
		<CustomAction Id="DefaultInstallDrive" Property="INSTALLDRIVE" Value="D:\" />

		<CustomActionRef Id="WixExitEarlyWithSuccess" />
		<!-- The name of the cab inside the MSI-->
		<Media Id="1" Cabinet="ApplicationContents.cab" EmbedCab="yes" />

		<!-- The Features to be installed -->
		<Feature Id="ProductFeature" Title="$(var.ProductName).Setup" Level="1">
			<!-- Note: The following ComponentGroupRef is required to pull in generated authoring from project references. -->
			<!--<ComponentGroupRef Id="Product.Generated" />-->
			<ComponentGroupRef Id="TescoDotComInstaller"/>
		</Feature>

		<Property Id ="INSTALLFOLDER"><![CDATA[D:\]]></Property>
		<Property Id="WIXUI_INSTALLDIR" Value="INSTALLMYACCOUNT" />

		<!-- This forces on to the D: Drive-->
		<!--<Property Id="ROOTDRIVE" Value="D:\"/>
    <Property Id="ARPNOMODIFY" Value="1" />-->

		<Directory Id="TARGETDIR" Name="SourceDir">
			<Directory Id="INSTALLFOLDER" Name=".">
				<Directory Id="INSTALLMYACCOUNT" Name="Automation_MVC_Reskin">
					<!--<Directory Id="ApplicationDirectory" Name="$(var.ApplicationName)">-->
					<!-- This is the location that the files will be published to -->
					<Component Id="ProductRegistryEntry" Guid="*">
						<!--GUID can be a * becuase major upgrades don't care about same GUIDS.-->
						<RegistryKey Root="HKLM" Key="$(var.DeployedRegistryKey)\$(var.PackageName)" Action="createAndRemoveOnUninstall">
							<RegistryValue Type="string" Name="ProductCode" Value="[ProductCode]" KeyPath="yes"/>
							<RegistryValue Type="string" Name="ProductVersion" Value="[ProductVersion]"/>
							<RegistryValue Type="string" Name="Label" Value="$(var.Label)"/>
						</RegistryKey>
					</Component>
				</Directory>
			</Directory>
		</Directory>
		<!--</Directory>-->

		<Upgrade Id='$(var.UpgradeCode)'>
			<UpgradeVersion Minimum='0.0.0.0' IncludeMinimum='yes' Maximum='255.255.65535.255' IncludeMaximum='yes' Property='UPGRADEFOUND' />
		</Upgrade>

		<!--<InstallExecuteSequence>
			<Custom Action='CreateEventCategories' After='InstallFiles'> Installed=""</Custom>
		</InstallExecuteSequence>-->


	</Product>

	<Fragment>
		<ComponentGroup Id="TescoDotComInstaller">
			<ComponentGroupRef Id="ApplicationFiles" />
			<ComponentRef Id="ProductRegistryEntry"/>
		</ComponentGroup>
	</Fragment>
</Wix>
