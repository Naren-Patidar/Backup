COMMUNISIS|CS|CSVO,CSVT,CSVTB,CSTO,CSTB,CSC|Christmas Savers|Customer has top-up voucher value >= £100|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK) Inner Join MailableCustomers m WITH(NOLOCK) ON m.HouseholdID = p.HouseholdID where p.TopupAmount >=100
COMMUNISIS|CS|CSVO,CSVT,CSVTB,CSTO,CSTB,CSC|Christmas Savers|Customer has max Clubcard voucher value|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK) Inner Join MailableCustomers m WITH(NOLOCK) ON m.HouseholdID = p.HouseholdID inner join (select max (isnull(TescoRewardValue,0)+ isnull(TescoBankRewardValue,0))  TotalRewardValue, m1.basestock from PointDetails p1 WITH(NOLOCK)Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID group by m1.basestock)i on i.basestock = m.basestock and i.TotalRewardValue = (isnull(p.TescoRewardValue,0)+ isnull(p.TescoBankRewardValue,0)) where m.HouseholdID is not null 
COMMUNISIS|CS|CSVO,CSVT,CSVTB,CSTO,CSTB,CSC|Christmas Savers|Customer has max top-up voucher value|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK) Inner Join MailableCustomers m WITH(NOLOCK) ON m.HouseholdID = p.HouseholdID inner join (select max (isnull(TopupAmount,0))TopupAmount,m1.basestock from PointDetails p1 WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID group by m1.basestock)i on i.basestock = m.basestock and i.TopupAmount = p.TopupAmount where p.TopupAmount > 0
COMMUNISIS|CS|CSVO,CSVT,CSVTB,CSTO,CSTB,CSC|Christmas Savers|Customer has max bonus voucher value|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK)Inner Join MailableCustomers m WITH(NOLOCK) ON m.HouseholdID = p.HouseholdID inner join (select max (isnull(BonusAmount,0))BonusAmount,m1.basestock from PointDetails p1 WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID group by m1.basestock)i on i.basestock = m.basestock and i.BonusAmount = p.BonusAmount where m.HouseholdID is not null
COMMUNISIS|CS|CSVO,CSVT,CSVTB,CSTO,CSTB,CSC|Christmas Savers|Customer has £3 bonus voucher|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK) Inner Join MailableCustomers m WITH(NOLOCK) ON m.HouseholdID = p.HouseholdID where isnull(p.BonusAmount,0) =3.00
COMMUNISIS|CS|CSVO,CSVT,CSVTB,CSTO,CSTB,CSC|Christmas Savers|Customer has Clubcard vouchers ONLY|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK) Inner Join MailableCustomers m WITH(NOLOCK) ON m.HouseholdID = p.HouseholdID where (isnull(p.TescoRewardValue,0)>0 or isnull(p.TescoBankRewardValue,0)>0) and isnull(p.TopupAmount,0)=0 and isnull(p.BonusAmount,0)=0 
COMMUNISIS|CS|CSVO,CSVT,CSVTB,CSTO,CSTB,CSC|Christmas Savers|Customer has Clubcard vouchers and top-up voucher ONLY|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK) Inner Join MailableCustomers m WITH(NOLOCK) ON m.HouseholdID = p.HouseholdID where (isnull(p.TescoRewardValue,0)>0 or isnull(p.TescoBankRewardValue,0)>0) and isnull(p.TopupAmount,0)>0 and isnull(p.BonusAmount,0)=0
COMMUNISIS|CS|CSVO,CSVT,CSVTB,CSTO,CSTB,CSC|Christmas Savers|Customer has Clubcard vouchers and top-up voucher and bonus voucher|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK) Inner Join MailableCustomers m WITH(NOLOCK) ON m.HouseholdID = p.HouseholdID where (isnull(p.TescoRewardValue,0)>0 or isnull(p.TescoBankRewardValue,0)>0) and isnull(p.TopupAmount,0)>0 and isnull(p.BonusAmount,0)>0 
COMMUNISIS|CS|CSVO,CSVT,CSVTB,CSTO,CSTB,CSC|Christmas Savers|Customer has Clubcard vouchers between £2 and £5|select Top 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK) Inner Join MailableCustomers m WITH(NOLOCK) ON m.HouseholdID = p.HouseholdID where ((isnull(p.TescoRewardValue,0) between 2 and 5) or (isnull(p.TescoBankRewardValue,0) between 2 and 5))
COMMUNISIS|CS|CSVO,CSVT,CSVTB,CSTO,CSTB,CSC|Christmas Savers|Customer has Clubcard vouchers between £5.50 and £10|select Top 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK) Inner Join MailableCustomers m WITH(NOLOCK) ON m.HouseholdID = p.HouseholdID where ((isnull(p.TescoRewardValue,0) between 5.50 and 10) or (isnull(p.TescoBankRewardValue,0) between 5.50 and 10))
COMMUNISIS|CS|CSVO,CSVT,CSVTB,CSTO,CSTB,CSC|Christmas Savers|Customer has Clubcard vouchers between £10.50 and £100|select Top 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK) Inner Join MailableCustomers m WITH(NOLOCK) ON m.HouseholdID = p.HouseholdID where ((isnull(p.TescoRewardValue,0) between 10.50 and 100) or (isnull(p.TescoBankRewardValue,0) between 10.50 and 100))
COMMUNISIS|CS|CSVO,CSVT,CSVTB,CSTO,CSTB,CSC|Christmas Savers|Customer has Clubcard vouchers between £100.50 and £150|select Top 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK) Inner Join MailableCustomers m WITH(NOLOCK) ON m.HouseholdID = p.HouseholdID where ((isnull(p.TescoRewardValue,0) between 100.50 and 150) or (isnull(p.TescoBankRewardValue,0) between 100.50 and 150))
COMMUNISIS|CS|CSVO,CSVT,CSVTB,CSTO,CSTB,CSC|Christmas Savers|Customer has Clubcard vouchers between £150.50 and £300|select Top 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK) Inner Join MailableCustomers m WITH(NOLOCK) ON m.HouseholdID = p.HouseholdID where ((isnull(p.TescoRewardValue,0) between 150.50 and 300) or (isnull(p.TescoBankRewardValue,0) between 150.50 and 300))
COMMUNISIS|CS|CSVO,CSVT,CSVTB,CSTO,CSTB,CSC|Christmas Savers|Customer has Clubcard vouchers between £300.50 and £100|select Top 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK) Inner Join MailableCustomers m WITH(NOLOCK) ON m.HouseholdID = p.HouseholdID where ((isnull(p.TescoRewardValue,0) between 300.50 and 1000) or (isnull(p.TescoBankRewardValue,0) between 300.50 and 1000))
COMMUNISIS|CS|CSVO,CSVT,CSVTB,CSTO,CSTB,CSC|Christmas Savers|Customer has only Top-Up vouchers between £2 and £5|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK) Inner Join MailableCustomers m WITH(NOLOCK) ON m.HouseholdID = p.HouseholdID where (isnull(p.TopupAmount,0) between 2 and 5) and (isnull(p.BonusAmount,0)=0 and (isnull(p.TescoRewardValue,0)=0 and isnull(p.TescoBankRewardValue,0)=0))
COMMUNISIS|CS|CSVO,CSVT,CSVTB,CSTO,CSTB,CSC|Christmas Savers|Customer has only Top-Up vouchers between £5.50 and £10|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK) Inner Join MailableCustomers m WITH(NOLOCK) ON m.HouseholdID = p.HouseholdID where (isnull(p.TopupAmount,0) between 5.50 and 10) and (isnull(p.BonusAmount,0)=0 and (isnull(p.TescoRewardValue,0)=0 and isnull(p.TescoBankRewardValue,0)=0))
COMMUNISIS|CS|CSVO,CSVT,CSVTB,CSTO,CSTB,CSC|Christmas Savers|Customer has only Top-Up vouchers between £10.50 and £100|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK) Inner Join MailableCustomers m WITH(NOLOCK) ON m.HouseholdID = p.HouseholdID where (isnull(p.TopupAmount,0) between 10.50 and 100) and (isnull(p.BonusAmount,0)=0 and (isnull(p.TescoRewardValue,0)=0 and isnull(p.TescoBankRewardValue,0)=0))
COMMUNISIS|CS|CSVO,CSVT,CSVTB,CSTO,CSTB,CSC|Christmas Savers|Customer has only Top-Up vouchers between £100.50 and £150|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK) Inner Join MailableCustomers m WITH(NOLOCK) ON m.HouseholdID = p.HouseholdID where (isnull(p.TopupAmount,0) between 100.50 and 150) and (isnull(p.BonusAmount,0)=0 and (isnull(p.TescoRewardValue,0)=0 and isnull(p.TescoBankRewardValue,0)=0))
COMMUNISIS|CS|CSVO,CSVT,CSVTB,CSTO,CSTB,CSC|Christmas Savers|Customer has only Top-Up vouchers between £150.50 and £300|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK) Inner Join MailableCustomers m WITH(NOLOCK) ON m.HouseholdID = p.HouseholdID where (isnull(p.TopupAmount,0) between 150.50 and 300) and (isnull(p.BonusAmount,0)=0 and (isnull(p.TescoRewardValue,0)=0 and isnull(p.TescoBankRewardValue,0)=0))
COMMUNISIS|CS|CSVO,CSVT,CSVTB,CSTO,CSTB,CSC|Christmas Savers|Customer has only Top-Up vouchers between £300.50 and £360|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK) Inner Join MailableCustomers m WITH(NOLOCK) ON m.HouseholdID = p.HouseholdID where (isnull(p.TopupAmount,0) between 300.50 and 360) and (isnull(p.BonusAmount,0)=0 and (isnull(p.TescoRewardValue,0)=0 and isnull(p.TescoBankRewardValue,0)=0))
COMMUNISIS|CS|CSVO,CSVT,CSVTB,CSTO,CSTB,CSC|Christmas Savers|Customer has only Top-Up vouchers between £360.50 and £1000|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK) Inner Join MailableCustomers m WITH(NOLOCK) ON m.HouseholdID = p.HouseholdID where (isnull(p.TopupAmount,0) between 360.50 and 1000) and (isnull(p.BonusAmount,0)=0 and (isnull(p.TescoRewardValue,0)=0 and isnull(p.TescoBankRewardValue,0)=0))
COMMUNISIS|CS|CSVO,CSVT,CSVTB,CSTO,CSTB,CSC|Christmas Savers|Customer has top-up vouchers and bonus voucher ONLY|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK) Inner Join MailableCustomers m WITH(NOLOCK) ON m.HouseholdID = p.HouseholdID where (isnull(p.TopupAmount,0)>0 and isnull(p.BonusAmount,0)>0) and (isnull(p.TescoRewardValue,0)=0 and isnull(p.TescoBankRewardValue,0)=0) 
COMMUNISIS|CS|CSVO,CSVT,CSVTB,CSTO,CSTB,CSC|Christmas Savers|Customer has max total voucher (Clubcard + top-up + bonus)|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK)Inner Join MailableCustomers m WITH(NOLOCK) ON m.HouseholdID = p.HouseholdID inner join(select max (isnull(TopupAmount,0)+isnull(BonusAmount,0)+isnull(TescoRewardValue,0)+isnull(TescoBankRewardValue,0) )TotalVoucher,m1.basestock from PointDetails p1 WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID group by m1.basestock)i on i.basestock = m.basestock and i.TotalVoucher = (isnull(p.TopupAmount,0) + isnull(p.BonusAmount,0)+ isnull(p.TescoRewardValue,0)+ isnull(p.TescoBankRewardValue,0))where m.HouseholdID is not null
COMMUNISIS|CS|CSVO,CSVT,CSVTB,CSTO,CSTB,CSC|Christmas Savers|Customer has top-up voucher value between £50 and £99.50|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK) Inner Join MailableCustomers m WITH(NOLOCK) ON m.HouseholdID = p.HouseholdID where (p.TopupAmount between 50 and 99.50) 