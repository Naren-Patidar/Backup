GI|UV|UV12,UVC,UVN12|Unspent Vouchers|1 normal voucher,3 reprinted vouchers|select m.HouseholdID, m.ClubcardID from MailableCustomers m with(nolock)inner join pointdetails p with(nolock) on m.HouseholdID = p.HouseholdID left join (select HouseHoldID, count(1) noofvoucher from UnspentVoucherDetailsFrmSV with(nolock) group by HouseHoldID) t on t.HouseHoldID = p.HouseholdID where p.NumberofVouchers = 1 and t.noofvoucher = 3
GI|UV|UV12,UVC,UVN12|Unspent Vouchers|2 normal vouchers,3 reprinted vouchers|select m.HouseholdID, m.ClubcardID from MailableCustomers m with(nolock)inner join pointdetails p with(nolock) on m.HouseholdID = p.HouseholdID left join(select HouseHoldID, count(1) noofvoucher from UnspentVoucherDetailsFrmSV with(nolock) group by HouseHoldID) t on t.HouseHoldID = p.HouseholdID where p.NumberofVouchers = 2 and t.noofvoucher = 3
GI|UV|UV12,UVC,UVN12|Unspent Vouchers|3 normal vouchers,3 reprinted vouchers|select m.HouseholdID, m.ClubcardID from MailableCustomers m with(nolock)inner join pointdetails p with(nolock) on m.HouseholdID = p.HouseholdID left join (select HouseHoldID, count(1) noofvoucher from UnspentVoucherDetailsFrmSV with(nolock) group by HouseHoldID) t on t.HouseHoldID = p.HouseholdID where p.NumberofVouchers = 3 and t.noofvoucher = 3
GI|UV|UV12,UVC,UVN12|Unspent Vouchers|1 normal voucher,2 reprinted vouchers|select m.HouseholdID, m.ClubcardID from MailableCustomers m with(nolock)inner join pointdetails p with(nolock) on m.HouseholdID = p.HouseholdID left join(select HouseHoldID, count(1) noofvoucher from UnspentVoucherDetailsFrmSV with(nolock) group by HouseHoldID) t on t.HouseHoldID = p.HouseholdID where p.NumberofVouchers = 1 and t.noofvoucher = 2 
GI|UV|UV12,UVC,UVN12|Unspent Vouchers|2 normal vouchers,2 reprinted vouchers|select m.HouseholdID, m.ClubcardID from MailableCustomers m with(nolock)inner join pointdetails p with(nolock) on m.HouseholdID = p.HouseholdID left join(select HouseHoldID, count(1) noofvoucher from UnspentVoucherDetailsFrmSV with(nolock) group by HouseHoldID) t on t.HouseHoldID = p.HouseholdID where p.NumberofVouchers = 2 and t.noofvoucher = 2 
GI|UV|UV12,UVC,UVN12|Unspent Vouchers|3 normal vouchers,2 reprinted vouchers|select m.HouseholdID, m.ClubcardID from MailableCustomers m with(nolock)inner join pointdetails p with(nolock) on m.HouseholdID = p.HouseholdID left join(select HouseHoldID, count(1) noofvoucher from UnspentVoucherDetailsFrmSV with(nolock) group by HouseHoldID) t on t.HouseHoldID = p.HouseholdID where p.NumberofVouchers = 3 and t.noofvoucher = 2
GI|UV|UV12,UVC,UVN12|Unspent Vouchers|1 normal voucher,1 reprinted voucher|select m.HouseholdID, m.ClubcardID from MailableCustomers m with(nolock)inner join pointdetails p with(nolock) on m.HouseholdID = p.HouseholdID left join(select HouseHoldID, count(1) noofvoucher from UnspentVoucherDetailsFrmSV with(nolock) group by HouseHoldID) t on t.HouseHoldID = p.HouseholdID where p.NumberofVouchers = 1 and t.noofvoucher = 1 
GI|UV|UV12,UVC,UVN12|Unspent Vouchers|2 normal vouchers,1 reprinted voucher|select m.HouseholdID, m.ClubcardID from MailableCustomers m with(nolock)inner join pointdetails p with(nolock) on m.HouseholdID = p.HouseholdID left join(select HouseHoldID, count(1) noofvoucher from UnspentVoucherDetailsFrmSV with(nolock) group by HouseHoldID) t on t.HouseHoldID = p.HouseholdID where p.NumberofVouchers = 2 and t.noofvoucher = 1
GI|UV|UV12,UVC,UVN12|Unspent Vouchers|3 normal vouchers,1 reprinted voucher|select m.HouseholdID, m.ClubcardID from MailableCustomers m with(nolock)inner join pointdetails p with(nolock) on m.HouseholdID = p.HouseholdID left join(select HouseHoldID, count(1) noofvoucher from UnspentVoucherDetailsFrmSV with(nolock) group by HouseHoldID) t on t.HouseHoldID = p.HouseholdID where p.NumberofVouchers = 3 and t.noofvoucher = 1 
GI|UV|UV12,UVC,UVN12|Unspent Vouchers|Max overall voucher total|select Top 1 m.HouseholdID, m.ClubcardID from MailableCustomers m with(nolock)inner join pointdetails p with(nolock) on m.HouseholdID = p.HouseholdID left join(select HouseHoldID, count(1) noofvoucher from UnspentVoucherDetailsFrmSV with(nolock) group by HouseHoldID) t on t.HouseHoldID = p.HouseholdID Inner Join ( select MAX(p1.TescoRewardValue + p1.TescoBankRewardValue) MaxOverAllVoucherTotal, m1.basestock from PointDetails p1  Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID group by m1.basestock) i on  i.basestock = m.basestock and i.MaxOverAllVoucherTotal = (p.TescoRewardValue + p.TescoBankRewardValue) WHERE m.HouseholdID IS NOT NULL 
GI|UV|UV12,UVC,UVN12|Unspent Vouchers|Max normal voucher total|select Top 1 m.HouseholdID, m.ClubcardID from MailableCustomers m with(nolock)inner join pointdetails p with(nolock) on m.HouseholdID = p.HouseholdID left join(select HouseHoldID, count(1) noofvoucher from UnspentVoucherDetailsFrmSV with(nolock) group by HouseHoldID) t on t.HouseHoldID = p.HouseholdID inner Join (select MAX(p1.TescoRewardValue + p1.TescoBankRewardValue) MaxNormalVoucherTotal , m1.basestock from PointDetails p1  Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID left join UnspentVoucherDetailsFrmSV  u with(nolock) on u.HouseHoldID = p1.HouseHoldID where u.HouseHoldID is not null group by m1.basestock)i on  i.basestock = m.basestock and i.MaxNormalVoucherTotal = (p.TescoRewardValue + p.TescoBankRewardValue) WHERE m.HouseholdID IS NOT NULL  




