GI|VOU|BP12,UV12,UVN12|Vouchers|Customer with max salutation - 2 names and 2 Clubcards|Select TOP 1 m.HouseholdID,m.ClubcardID from MailableCustomers m WITH(NOLOCK)Inner Join associateCustomerDetails ac ON m.HouseholdID =ac.HouseholdID Inner Join ( Select MAX(LEN(TitleEnglish + Name1 + Name2 + Name3 + m1.CustomerName1 + m1.CustomerName2 + m1.CustomerName3 + m1.CustomerTitle )) SalutationMaxLenght, m1.basestock from associateCustomerDetails ac WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = ac.HouseholdID AND m1.CustomerName1 != ac.Name1 Inner Join 	(  Select m.HouseHoldID, count(distinct (ac1.AssociateClubcardID)) as 'CardCount' from associateCustomerDetails ac1 WITH(NOLOCK)   Inner join MailableCustomers m WITH(NOLOCK) on ac1.HouseHoldID = m.HouseHoldID Group by m.HouseHoldID Having count(distinct (ac1.AssociateClubcardID))= 2) tblCardCount On tblCardCount.HouseholdID=m1.HouseholdID  group by m1.basestock ) MaxSalu On MaxSalu.Basestock = m.Basestock  AND MaxSalu.SalutationMaxLenght=LEN(ac.TitleEnglish + ac.Name1 + ac.Name2 + ac.Name3 + m.CustomerName1 + m.CustomerName2 + m.CustomerName3 + m.CustomerTitle) Where m.HouseholdID IS NOT NULL         
GI|VOU|BP12,UV12,UVN12|Vouchers|Customer with max salutation - 2 names and 1 Clubcard|Select TOP 1 m.HouseholdID,m.ClubcardID from MailableCustomers m WITH(NOLOCK)Inner Join associateCustomerDetails ac ON m.HouseholdID =ac.HouseholdID Inner Join ( Select MAX(LEN(TitleEnglish + Name1 + Name2 + Name3 + m1.CustomerName1 + m1.CustomerName2 + m1.CustomerName3 + m1.CustomerTitle )) SalutationMaxLenght, m1.basestock from associateCustomerDetails ac WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = ac.HouseholdID AND m1.CustomerName1 != ac.Name1 Inner Join 	(  Select m.HouseHoldID, count(distinct (ac1.AssociateClubcardID)) as 'CardCount' from associateCustomerDetails ac1 WITH(NOLOCK)   Inner join MailableCustomers m WITH(NOLOCK) on ac1.HouseHoldID = m.HouseHoldID Group by m.HouseHoldID Having count(distinct (ac1.AssociateClubcardID))= 1) tblCardCount On tblCardCount.HouseholdID=m1.HouseholdID  group by m1.basestock ) MaxSalu On MaxSalu.Basestock = m.Basestock  AND MaxSalu.SalutationMaxLenght=LEN(ac.TitleEnglish + ac.Name1 + ac.Name2 + ac.Name3 + m.CustomerName1 + m.CustomerName2 + m.CustomerName3 + m.CustomerTitle) Where m.HouseholdID IS NOT NULL 
GI|VOU|BP12,UV12,UVN12|Vouchers|Customer with max salutation - 1 name and 1 Clubcard|Select TOP 1 m.HouseholdID,m.ClubcardID from MailableCustomers m WITH(NOLOCK)Inner Join associateCustomerDetails ac ON m.HouseholdID =ac.HouseholdID Inner Join ( Select MAX(LEN(TitleEnglish + Name1 + Name2 + Name3 + m1.CustomerName1 + m1.CustomerName2 + m1.CustomerName3 + m1.CustomerTitle )) SalutationMaxLenght, m1.basestock from associateCustomerDetails ac WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = ac.HouseholdID AND m1.CustomerName1 = ac.Name1 Inner Join 	(  Select m.HouseHoldID, count(distinct (ac1.AssociateClubcardID)) as 'CardCount' from associateCustomerDetails ac1 WITH(NOLOCK)   Inner join MailableCustomers m WITH(NOLOCK) on ac1.HouseHoldID = m.HouseHoldID Group by m.HouseHoldID Having count(distinct (ac1.AssociateClubcardID))= 1) tblCardCount On tblCardCount.HouseholdID=m1.HouseholdID  group by m1.basestock ) MaxSalu On MaxSalu.Basestock = m.Basestock  AND MaxSalu.SalutationMaxLenght=LEN(ac.TitleEnglish + ac.Name1 + ac.Name2 + ac.Name3 + m.CustomerName1 + m.CustomerName2 + m.CustomerName3 + m.CustomerTitle) Where m.HouseholdID IS NOT NULL      
GI|VOU|BP12,UV12,UVN12|Vouchers|Customer with max salutation - 1 name and 2 Clubcard|Select TOP 1 m.HouseholdID,m.ClubcardID from MailableCustomers m WITH(NOLOCK)Inner Join associateCustomerDetails ac ON m.HouseholdID =ac.HouseholdID Inner Join ( Select MAX(LEN(TitleEnglish + Name1 + Name2 + Name3 + m1.CustomerName1 + m1.CustomerName2 + m1.CustomerName3 + m1.CustomerTitle )) SalutationMaxLenght, m1.basestock from associateCustomerDetails ac WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = ac.HouseholdID AND m1.CustomerName1 = ac.Name1 Inner Join 	(  Select m.HouseHoldID, count(distinct (ac1.AssociateClubcardID)) as 'CardCount' from associateCustomerDetails ac1 WITH(NOLOCK)   Inner join MailableCustomers m WITH(NOLOCK) on ac1.HouseHoldID = m.HouseHoldID Group by m.HouseHoldID Having count(distinct (ac1.AssociateClubcardID))= 2) tblCardCount On tblCardCount.HouseholdID=m1.HouseholdID  group by m1.basestock ) MaxSalu On MaxSalu.Basestock = m.Basestock  AND MaxSalu.SalutationMaxLenght=LEN(ac.TitleEnglish + ac.Name1 + ac.Name2 + ac.Name3 + m.CustomerName1 + m.CustomerName2 + m.CustomerName3 + m.CustomerTitle) Where m.HouseholdID IS NOT NULL         
GI|VOU|BP12,UV12,UVN12|Vouchers|Customer with 50p voucher (min voucher value)|select top 1 m.HouseholdID ,m.ClubcardID  from MailableCustomers m WITH(NOLOCK)Inner Join PointDetails p WITH(NOLOCK) on m.HouseholdID = p.HouseholdID Inner join EANVoucherType EV WITH(NOLOCK) ON ev.VoucherValue=0.50 where p.TescoBankVoucherEAN like '%'+ ev.VoucherEAN + '%' 
GI|VOU|BP12,UV12,UVN12|Vouchers|Customer with £1.00 voucher only (min reward)|select top 1 m.HouseholdID, m.ClubcardID  from MailableCustomers m WITH(NOLOCK)Inner Join PointDetails p WITH(NOLOCK) on m.HouseholdID = p.HouseholdID Inner join EANVoucherType EV WITH(NOLOCK) ON ev.VoucherValue=1.00 where p.TescoBankVoucherEAN like '%'+ ev.VoucherEAN + '%' 
GI|VOU|BP12,UV12,UVN12|Vouchers|Customer with max voucher value (1 voucher)|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK)Inner Join MailableCustomers m WITH(NOLOCK) on m.HouseholdID = p.HouseholdID INNER JOIN (Select MAX(p1.TescoRewardValue) TescoRewardValue, m1.basestock from PointDetails p1 WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID WHERE p1.NumberofVouchers = 1 group by m1.basestock ) i on  i.basestock = m.basestock and i.TescoRewardValue = p.TescoRewardValue WHERE p.NumberofVouchers = 1
GI|VOU|BP12,UV12,UVN12|Vouchers|Customer with max voucher value (2 vouchers)|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK)Inner Join MailableCustomers m WITH(NOLOCK) on m.HouseholdID = p.HouseholdID INNER JOIN (Select MAX(p1.TescoRewardValue) TescoRewardValue, m1.basestock from PointDetails p1 WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID WHERE p1.NumberofVouchers = 2 group by m1.basestock ) i on  i.basestock = m.basestock and i.TescoRewardValue = p.TescoRewardValue WHERE p.NumberofVouchers = 2
GI|VOU|BP12,UV12,UVN12|Vouchers|Customer with max voucher value (3 vouchers)|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK)Inner Join MailableCustomers m WITH(NOLOCK) on m.HouseholdID = p.HouseholdID INNER JOIN (Select MAX(p1.TescoRewardValue) TescoRewardValue, m1.basestock from PointDetails p1 WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID WHERE p1.NumberofVouchers = 3 group by m1.basestock ) i on  i.basestock = m.basestock and i.TescoRewardValue = p.TescoRewardValue WHERE p.NumberofVouchers = 3
GI|VOU|BP12,UV12,UVN12|Vouchers|Customer with max voucher value (6 vouchers)|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK)Inner Join MailableCustomers m WITH(NOLOCK) on m.HouseholdID = p.HouseholdID INNER JOIN (Select MAX(p1.TescoRewardValue) TescoRewardValue, m1.basestock from PointDetails p1 WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID WHERE p1.NumberofVouchers = 6 group by m1.basestock ) i on  i.basestock = m.basestock and i.TescoRewardValue = p.TescoRewardValue WHERE p.NumberofVouchers = 6
GI|VOU|BP12,UV12,UVN12|Vouchers|Customer with max voucher value (6+ vouchers)|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK)Inner Join MailableCustomers m WITH(NOLOCK) on m.HouseholdID = p.HouseholdID INNER JOIN (Select MAX(p1.TescoRewardValue) TescoRewardValue, m1.basestock from PointDetails p1 WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID WHERE p1.NumberofVouchers > 6 group by m1.basestock ) i on  i.basestock = m.basestock and i.TescoRewardValue = p.TescoRewardValue WHERE p.NumberofVouchers > 6
GI|VOU|BP12,UV12,UVN12|Vouchers|Customer with min voucher value (1 voucher)|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK)Inner Join MailableCustomers m WITH(NOLOCK) on m.HouseholdID = p.HouseholdID INNER JOIN (Select MIN(p1.TescoRewardValue) TescoRewardValue, m1.basestock from PointDetails p1 WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID WHERE p1.NumberofVouchers = 1 group by m1.basestock ) i on  i.basestock = m.basestock and i.TescoRewardValue = p.TescoRewardValue WHERE p.NumberofVouchers = 1
GI|VOU|BP12,UV12,UVN12|Vouchers|Customer with min voucher value (2 vouchers)|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK)Inner Join MailableCustomers m WITH(NOLOCK) on m.HouseholdID = p.HouseholdID INNER JOIN (Select MIN(p1.TescoRewardValue) TescoRewardValue, m1.basestock from PointDetails p1 WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID WHERE p1.NumberofVouchers = 2 group by m1.basestock ) i on  i.basestock = m.basestock and i.TescoRewardValue = p.TescoRewardValue WHERE p.NumberofVouchers = 2
GI|VOU|BP12,UV12,UVN12|Vouchers|Customer with min voucher value (3 vouchers)|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK)Inner Join MailableCustomers m WITH(NOLOCK) on m.HouseholdID = p.HouseholdID INNER JOIN (Select MIN(p1.TescoRewardValue) TescoRewardValue, m1.basestock from PointDetails p1 WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID WHERE p1.NumberofVouchers = 3 group by m1.basestock ) i on  i.basestock = m.basestock and i.TescoRewardValue = p.TescoRewardValue WHERE p.NumberofVouchers = 3
GI|VOU|BP12,UV12,UVN12|Vouchers|Customer with min voucher value (6 vouchers)|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK)Inner Join MailableCustomers m WITH(NOLOCK) on m.HouseholdID = p.HouseholdID INNER JOIN (Select MIN(p1.TescoRewardValue) TescoRewardValue, m1.basestock from PointDetails p1 WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID WHERE p1.NumberofVouchers = 6 group by m1.basestock ) i on  i.basestock = m.basestock and i.TescoRewardValue = p.TescoRewardValue WHERE p.NumberofVouchers = 6
GI|VOU|BP12,UV12,UVN12|Vouchers|Customer with min voucher value (6+ vouchers)|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK)Inner Join MailableCustomers m WITH(NOLOCK) on m.HouseholdID = p.HouseholdID INNER JOIN (Select MIN(p1.TescoRewardValue) TescoRewardValue, m1.basestock from PointDetails p1 WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID WHERE p1.NumberofVouchers > 6 group by m1.basestock ) i on  i.basestock = m.basestock and i.TescoRewardValue = p.TescoRewardValue WHERE p.NumberofVouchers > 6
COMMUNISIS|VOU|BD12,TD12,HV12|Vouchers|Customer with max salutation - 2 names and 2 Clubcards|Select TOP 1 m.HouseholdID,m.ClubcardID from MailableCustomers m WITH(NOLOCK)Inner Join associateCustomerDetails ac ON m.HouseholdID =ac.HouseholdID Inner Join ( Select MAX(LEN(TitleEnglish + Name1 + Name2 + Name3 + m1.CustomerName1 + m1.CustomerName2 + m1.CustomerName3 + m1.CustomerTitle )) SalutationMaxLenght, m1.basestock from associateCustomerDetails ac WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = ac.HouseholdID AND m1.CustomerName1 != ac.Name1 Inner Join 	(  Select m.HouseHoldID, count(distinct (ac1.AssociateClubcardID)) as 'CardCount' from associateCustomerDetails ac1 WITH(NOLOCK)   Inner join MailableCustomers m WITH(NOLOCK) on ac1.HouseHoldID = m.HouseHoldID Group by m.HouseHoldID Having count(distinct (ac1.AssociateClubcardID))= 2) tblCardCount On tblCardCount.HouseholdID=m1.HouseholdID  group by m1.basestock ) MaxSalu On MaxSalu.Basestock = m.Basestock  AND MaxSalu.SalutationMaxLenght=LEN(ac.TitleEnglish + ac.Name1 + ac.Name2 + ac.Name3 + m.CustomerName1 + m.CustomerName2 + m.CustomerName3 + m.CustomerTitle) Where m.HouseholdID IS NOT NULL          
COMMUNISIS|VOU|BD12,TD12,HV12|Vouchers|Customer with max salutation - 2 names and 1 Clubcard|Select TOP 1 m.HouseholdID,m.ClubcardID from MailableCustomers m WITH(NOLOCK)Inner Join associateCustomerDetails ac ON m.HouseholdID =ac.HouseholdID Inner Join ( Select MAX(LEN(TitleEnglish + Name1 + Name2 + Name3 + m1.CustomerName1 + m1.CustomerName2 + m1.CustomerName3 + m1.CustomerTitle )) SalutationMaxLenght, m1.basestock from associateCustomerDetails ac WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = ac.HouseholdID AND m1.CustomerName1 != ac.Name1 Inner Join 	(  Select m.HouseHoldID, count(distinct (ac1.AssociateClubcardID)) as 'CardCount' from associateCustomerDetails ac1 WITH(NOLOCK)   Inner join MailableCustomers m WITH(NOLOCK) on ac1.HouseHoldID = m.HouseHoldID Group by m.HouseHoldID Having count(distinct (ac1.AssociateClubcardID))= 1) tblCardCount On tblCardCount.HouseholdID=m1.HouseholdID  group by m1.basestock ) MaxSalu On MaxSalu.Basestock = m.Basestock  AND MaxSalu.SalutationMaxLenght=LEN(ac.TitleEnglish + ac.Name1 + ac.Name2 + ac.Name3 + m.CustomerName1 + m.CustomerName2 + m.CustomerName3 + m.CustomerTitle) Where m.HouseholdID IS NOT NULL 
COMMUNISIS|VOU|BD12,TD12,HV12|Vouchers|Customer with max salutation - 1 name and 1 Clubcard|Select TOP 1 m.HouseholdID,m.ClubcardID from MailableCustomers m WITH(NOLOCK)Inner Join associateCustomerDetails ac ON m.HouseholdID =ac.HouseholdID Inner Join ( Select MAX(LEN(TitleEnglish + Name1 + Name2 + Name3 + m1.CustomerName1 + m1.CustomerName2 + m1.CustomerName3 + m1.CustomerTitle )) SalutationMaxLenght, m1.basestock from associateCustomerDetails ac WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = ac.HouseholdID AND m1.CustomerName1 = ac.Name1 Inner Join 	(  Select m.HouseHoldID, count(distinct (ac1.AssociateClubcardID)) as 'CardCount' from associateCustomerDetails ac1 WITH(NOLOCK)   Inner join MailableCustomers m WITH(NOLOCK) on ac1.HouseHoldID = m.HouseHoldID Group by m.HouseHoldID Having count(distinct (ac1.AssociateClubcardID))= 1) tblCardCount On tblCardCount.HouseholdID=m1.HouseholdID  group by m1.basestock ) MaxSalu On MaxSalu.Basestock = m.Basestock  AND MaxSalu.SalutationMaxLenght=LEN(ac.TitleEnglish + ac.Name1 + ac.Name2 + ac.Name3 + m.CustomerName1 + m.CustomerName2 + m.CustomerName3 + m.CustomerTitle) Where m.HouseholdID IS NOT NULL 
COMMUNISIS|VOU|BD12,TD12,HV12|Vouchers|Customer with max salutation - 1 name and 2 Clubcard|Select TOP 1 m.HouseholdID,m.ClubcardID from MailableCustomers m WITH(NOLOCK)Inner Join associateCustomerDetails ac ON m.HouseholdID =ac.HouseholdID Inner Join ( Select MAX(LEN(TitleEnglish + Name1 + Name2 + Name3 + m1.CustomerName1 + m1.CustomerName2 + m1.CustomerName3 + m1.CustomerTitle )) SalutationMaxLenght, m1.basestock from associateCustomerDetails ac WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = ac.HouseholdID AND m1.CustomerName1 = ac.Name1 Inner Join 	(  Select m.HouseHoldID, count(distinct (ac1.AssociateClubcardID)) as 'CardCount' from associateCustomerDetails ac1 WITH(NOLOCK)   Inner join MailableCustomers m WITH(NOLOCK) on ac1.HouseHoldID = m.HouseHoldID Group by m.HouseHoldID Having count(distinct (ac1.AssociateClubcardID))= 2) tblCardCount On tblCardCount.HouseholdID=m1.HouseholdID  group by m1.basestock ) MaxSalu On MaxSalu.Basestock = m.Basestock  AND MaxSalu.SalutationMaxLenght=LEN(ac.TitleEnglish + ac.Name1 + ac.Name2 + ac.Name3 + m.CustomerName1 + m.CustomerName2 + m.CustomerName3 + m.CustomerTitle) Where m.HouseholdID IS NOT NULL 
COMMUNISIS|VOU|BD12,TD12,HV12|Vouchers|Customer with 50p voucher (min voucher value)|select top 1 m.HouseholdID ,m.ClubcardID  from MailableCustomers m WITH(NOLOCK)Inner Join PointDetails p WITH(NOLOCK) on m.HouseholdID = p.HouseholdID Inner join EANVoucherType EV WITH(NOLOCK) ON ev.VoucherValue=0.50 where p.TescoBankVoucherEAN like '%'+ ev.VoucherEAN + '%' 
COMMUNISIS|VOU|BD12,TD12,HV12|Vouchers|Customer with £1.00 voucher only (min reward)|select top 1 m.HouseholdID, m.ClubcardID  from MailableCustomers m WITH(NOLOCK)Inner Join PointDetails p WITH(NOLOCK) on m.HouseholdID = p.HouseholdID Inner join EANVoucherType EV WITH(NOLOCK) ON ev.VoucherValue=1.00 where p.TescoBankVoucherEAN like '%'+ ev.VoucherEAN + '%' 
COMMUNISIS|VOU|BD12,TD12,HV12|Vouchers|Customer with max voucher value (1 voucher)|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK)Inner Join MailableCustomers m WITH(NOLOCK) on m.HouseholdID = p.HouseholdID INNER JOIN (Select MAX(p1.TescoRewardValue) TescoRewardValue, m1.basestock from PointDetails p1 WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID WHERE p1.NumberofVouchers = 1 group by m1.basestock ) i on  i.basestock = m.basestock and i.TescoRewardValue = p.TescoRewardValue WHERE p.NumberofVouchers = 1
COMMUNISIS|VOU|BD12,TD12,HV12|Vouchers|Customer with max voucher value (2 vouchers)|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK)Inner Join MailableCustomers m WITH(NOLOCK) on m.HouseholdID = p.HouseholdID INNER JOIN (Select MAX(p1.TescoRewardValue) TescoRewardValue, m1.basestock from PointDetails p1 WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID WHERE p1.NumberofVouchers = 2 group by m1.basestock ) i on  i.basestock = m.basestock and i.TescoRewardValue = p.TescoRewardValue WHERE p.NumberofVouchers = 2
COMMUNISIS|VOU|BD12,TD12,HV12|Vouchers|Customer with max voucher value (3 vouchers)|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK)Inner Join MailableCustomers m WITH(NOLOCK) on m.HouseholdID = p.HouseholdID INNER JOIN (Select MAX(p1.TescoRewardValue) TescoRewardValue, m1.basestock from PointDetails p1 WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID WHERE p1.NumberofVouchers = 3 group by m1.basestock ) i on  i.basestock = m.basestock and i.TescoRewardValue = p.TescoRewardValue WHERE p.NumberofVouchers = 3
COMMUNISIS|VOU|BD12,TD12,HV12|Vouchers|Customer with max voucher value (6 vouchers)|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK)Inner Join MailableCustomers m WITH(NOLOCK) on m.HouseholdID = p.HouseholdID INNER JOIN (Select MAX(p1.TescoRewardValue) TescoRewardValue, m1.basestock from PointDetails p1 WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID WHERE p1.NumberofVouchers = 6 group by m1.basestock ) i on  i.basestock = m.basestock and i.TescoRewardValue = p.TescoRewardValue WHERE p.NumberofVouchers = 6
COMMUNISIS|VOU|BD12,TD12,HV12|Vouchers|Customer with max voucher value (6+ vouchers)|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK)Inner Join MailableCustomers m WITH(NOLOCK) on m.HouseholdID = p.HouseholdID INNER JOIN (Select MAX(p1.TescoRewardValue) TescoRewardValue, m1.basestock from PointDetails p1 WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID WHERE p1.NumberofVouchers > 6 group by m1.basestock ) i on  i.basestock = m.basestock and i.TescoRewardValue = p.TescoRewardValue WHERE p.NumberofVouchers > 6
COMMUNISIS|VOU|BD12,TD12,HV12|Vouchers|Customer with min voucher value (1 voucher)|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK)Inner Join MailableCustomers m WITH(NOLOCK) on m.HouseholdID = p.HouseholdID INNER JOIN (Select MIN(p1.TescoRewardValue) TescoRewardValue, m1.basestock from PointDetails p1 WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID WHERE p1.NumberofVouchers = 1 group by m1.basestock ) i on  i.basestock = m.basestock and i.TescoRewardValue = p.TescoRewardValue WHERE p.NumberofVouchers = 1
COMMUNISIS|VOU|BD12,TD12,HV12|Vouchers|Customer with min voucher value (2 vouchers)|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK)Inner Join MailableCustomers m WITH(NOLOCK) on m.HouseholdID = p.HouseholdID INNER JOIN (Select MIN(p1.TescoRewardValue) TescoRewardValue, m1.basestock from PointDetails p1 WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID WHERE p1.NumberofVouchers = 2 group by m1.basestock ) i on  i.basestock = m.basestock and i.TescoRewardValue = p.TescoRewardValue WHERE p.NumberofVouchers = 2
COMMUNISIS|VOU|BD12,TD12,HV12|Vouchers|Customer with min voucher value (3 vouchers)|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK)Inner Join MailableCustomers m WITH(NOLOCK) on m.HouseholdID = p.HouseholdID INNER JOIN (Select MIN(p1.TescoRewardValue) TescoRewardValue, m1.basestock from PointDetails p1 WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID WHERE p1.NumberofVouchers = 3 group by m1.basestock ) i on  i.basestock = m.basestock and i.TescoRewardValue = p.TescoRewardValue WHERE p.NumberofVouchers = 3
COMMUNISIS|VOU|BD12,TD12,HV12|Vouchers|Customer with min voucher value (6 vouchers)|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK)Inner Join MailableCustomers m WITH(NOLOCK) on m.HouseholdID = p.HouseholdID INNER JOIN (Select MIN(p1.TescoRewardValue) TescoRewardValue, m1.basestock from PointDetails p1 WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID WHERE p1.NumberofVouchers = 6 group by m1.basestock ) i on  i.basestock = m.basestock and i.TescoRewardValue = p.TescoRewardValue WHERE p.NumberofVouchers = 6
COMMUNISIS|VOU|BD12,TD12,HV12|Vouchers|Customer with min voucher value (6+ vouchers)|select TOP 1 p.HouseholdID, m.ClubcardID from PointDetails p WITH(NOLOCK)Inner Join MailableCustomers m WITH(NOLOCK) on m.HouseholdID = p.HouseholdID INNER JOIN (Select MIN(p1.TescoRewardValue) TescoRewardValue, m1.basestock from PointDetails p1 WITH(NOLOCK) Inner Join MailableCustomers m1 WITH(NOLOCK) ON m1.HouseholdID = p1.HouseholdID WHERE p1.NumberofVouchers > 6 group by m1.basestock ) i on  i.basestock = m.basestock and i.TescoRewardValue = p.TescoRewardValue WHERE p.NumberofVouchers > 6








                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    